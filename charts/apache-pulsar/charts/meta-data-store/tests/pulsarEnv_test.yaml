suite: Test meta-data-store pulsar env
release:
  name: pulsar-luna
  namespace: luna
templates:
  - charts/metaDataStore/templates/pulsar_env.yaml
tests:
  - it: should be correct document
    asserts:
      - containsDocument:
          kind: ConfigMap
          apiVersion: v1

  - it: should have correct metadata
    set:
      global:
        commonLabels:
          aaa: bbb
        commonAnnotations:
          something: somewhere
    asserts:
      - equal:
          path: metadata
          value:
            annotations:
              something: somewhere
            labels:
              aaa: bbb
              app.kubernetes.io/component: meta-data-store
              app.kubernetes.io/instance: pulsar-luna
              app.kubernetes.io/managed-by: Helm
              app.kubernetes.io/name: meta-data-store
              app.kubernetes.io/part-of: pulsar-luna
              helm.sh/chart: metaDataStore-0.1.0
            name: meta-data-store-pulsar_env
            namespace: luna

  - it: should have extra opts for ssl
    set:
      global:
        interComponentTls:
          enabled: true
    asserts:
      - matchRegex:
          path: data.pulsar_env\.sh
          pattern: "-Djavax.net.ssl.trustStorePassword=/pulsar/jks-password"
      - matchRegex:
          path: data.pulsar_env\.sh
          pattern: "-Djavax.net.ssl.keyStorePassword=/pulsar/jks-password"
      - matchRegex:
          path: data.pulsar_env\.sh
          pattern: "-Djavax.net.ssl.keyStore=/pulsar/keystore.jks"
      - matchRegex:
          path: data.pulsar_env\.sh
          pattern: "-Djavax.net.ssl.trustStore=/pulsar/truststore.jks"